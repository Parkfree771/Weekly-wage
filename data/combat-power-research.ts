/**
 * ═══════════════════════════════════════════════════════════════
 * 전투력 역산 연구 데이터 (25년 7월 9일 패치 반영)
 * ═══════════════════════════════════════════════════════════════
 *
 * 출처: 유저 분석 자료 기반
 *
 * ■ 핵심 공식:
 *   전투력 = 순수기본공격력 × 0.0288 × Π(1 + 요소%)
 *   모든 요소는 곱연산으로 처리
 *
 * ■ 기본 공격력:
 *   sqrt(힘민지 × 무기공격력 / 6)
 *   - 공격력+, 공격력% 효과는 기본 공격력에 반영되지 않음
 *   - 대신 기본공격력 ~142,000 기준 딜 증가량으로 별도 반영
 *   - 만찬/음식 등 일시 버프는 반영 안 됨
 */

// ═══════════════════════════════════════
// 1. 전투 레벨 계수
// ═══════════════════════════════════════
export const COMBAT_LEVEL_MULTIPLIER: Record<string, number> = {
  '55-59': 8.95,
  '60-64': 18.56,
  '65-69': 23.97,
  '70': 29.45,
};

// ═══════════════════════════════════════
// 2. 무기 품질
// ═══════════════════════════════════════
// 무기 품질의 추가 피해량% = 전투력 증가%
// 품질 100 = 30.00%
// 일부 품질에서 0.01% 오차 가능 (예: 품질 95 추가피해 28.06% → 전투력 28.05%)
export const WEAPON_QUALITY_NOTE = '무기 품질의 추가 피해량% = 전투력 증가%. 품질 100 = 30.00%';

// ═══════════════════════════════════════
// 3. 아크 패시브
// ═══════════════════════════════════════
export const ARK_PASSIVE = {
  /** 진화 2T-4T 포인트당 0.5%, 80포인트 = 40% */
  evolution: { perPoint: 0.5, maxPoints: 80, maxPercent: 40.0 },
  /** 깨달음 포인트당 0.7%, 100포인트 = 70% */
  enlightenment: { perPoint: 0.7, maxPoints: 100, maxPercent: 70.0 },
  /** 도약 포인트당 0.2%, 70포인트 = 14% */
  leap: { perPoint: 0.2, maxPoints: 70, maxPercent: 14.0 },
};

// ═══════════════════════════════════════
// 4. 카르마
// ═══════════════════════════════════════
export const KARMA = {
  evolution: {
    /** 1랭크당 진화형 피해 1% 증가, 전투력 0.6% 증가. 6랭크 = 3.6% */
    perRank: 0.6,
    maxRank: 6,
    perLevelNote: '1레벨당 최대 생명력 → 전투력 영향 없음',
  },
  enlightenment: {
    perLevelNote: '1레벨당 무기 공격력 % → 기본 공격력 상승 (플레이어마다 다름)',
    perRankNote: '1랭크당 깨달음 포인트 1 → 0.7% (노드 찍을 수 있는 경우에만)',
  },
  leap: {
    /** 1레벨당 초각성기 피해 0.5% 증가 → 전투력 0.02% 증가 */
    perLevel: 0.02,
    /** 1랭크당 도약 포인트 2 → 0.4% */
    perRank: 0.4,
  },
};

// ═══════════════════════════════════════
// 5. 각인 계수 테이블
// ═══════════════════════════════════════
// 행: 유각 0/5/10/15/20장
// 열: 어빌스톤 레벨 0/1/2/3/4
// 값: 전투력 증가율 (%)

export type EngravingMatrix = number[][];

export const ENGRAVING_DATA: Record<string, {
  matrix: EngravingMatrix;
  aliases?: string[];  // 같은 계수를 공유하는 각인
}> = {
  '원한': {
    matrix: [
      [18.00, 21.00, 21.75, 23.25, 24.00],  // 유각 0장
      [18.75, 21.75, 22.50, 24.00, 24.75],  // 유각 5장
      [19.50, 22.50, 23.25, 24.75, 25.50],  // 유각 10장
      [20.25, 23.25, 24.00, 25.50, 26.25],  // 유각 15장
      [21.00, 24.00, 24.75, 26.25, 27.00],  // 유각 20장
    ],
  },
  '아드레날린': {
    matrix: [
      [15.20, 18.08, 18.80, 20.18, 20.90],
      [16.25, 19.13, 19.85, 21.23, 21.95],
      [17.30, 20.18, 20.90, 22.28, 23.00],
      [18.35, 21.23, 21.95, 23.33, 24.05],
      [19.40, 22.28, 23.00, 24.38, 25.10],
    ],
  },
  '돌격대장': {
    matrix: [
      [16.00, 19.00, 19.76, 21.28, 22.00],
      [16.80, 19.80, 20.56, 22.08, 22.80],
      [17.60, 20.60, 21.36, 22.88, 23.60],
      [18.40, 21.40, 22.16, 23.68, 24.40],
      [19.20, 22.20, 22.96, 24.48, 25.20],
    ],
  },
  '질량 증가': {
    matrix: [
      [16.00, 19.00, 19.75, 21.25, 22.00],
      [16.75, 19.75, 20.50, 22.00, 22.75],
      [17.50, 20.50, 21.25, 22.75, 23.50],
      [18.25, 21.25, 22.00, 23.50, 24.25],
      [19.00, 22.00, 22.75, 24.25, 25.00],
    ],
  },
  '결투의 대가': {
    matrix: [
      [15.30, 18.00, 18.70, 20.00, 20.70],
      [16.00, 18.70, 19.40, 20.70, 21.40],
      [16.70, 19.40, 20.10, 21.40, 22.10],
      [17.40, 20.10, 20.80, 22.10, 22.80],
      [18.10, 20.80, 21.50, 22.80, 23.50],
    ],
    aliases: ['기습의 대가'],
  },
  '예리한 둔기': {
    matrix: [
      [14.39, 17.18, 17.89, 19.31, 19.98],
      [15.13, 17.92, 18.63, 20.05, 20.72],
      [15.88, 18.67, 19.38, 20.80, 21.47],
      [16.62, 19.41, 20.12, 21.54, 22.21],
      [17.36, 20.15, 20.86, 22.28, 22.95],
    ],
  },
  '달인의 저력': {
    matrix: [
      [14.00, 17.00, 17.75, 19.25, 20.00],
      [14.75, 17.75, 18.50, 20.00, 20.75],
      [15.50, 18.50, 19.25, 20.75, 21.50],
      [16.25, 19.25, 20.00, 21.50, 22.25],
      [17.00, 20.00, 20.75, 22.25, 23.00],
    ],
    aliases: ['바리케이드', '안정된 상태', '저주받은 인형', '타격의 대가'],
  },
  '속전속결': {
    matrix: [
      [14.40, 16.80, 17.40, 18.60, 19.20],
      [15.00, 17.40, 18.00, 19.20, 19.80],
      [15.60, 18.00, 18.60, 19.80, 20.40],
      [16.20, 18.60, 19.20, 20.40, 21.00],
      [16.80, 19.20, 19.80, 21.00, 21.60],
    ],
    aliases: ['슈퍼 차지'],
  },
  '에테르 포식자': {
    matrix: [
      [12.60, 15.60, 16.50, 18.00, 18.60],
      [13.50, 16.50, 17.40, 18.90, 19.50],
      [14.40, 17.40, 18.30, 19.80, 20.40],
      [15.30, 18.30, 19.20, 20.70, 21.30],
      [16.20, 19.20, 20.10, 21.60, 22.20],
    ],
  },
  '마나 효율 증가': {
    matrix: [
      [13.00, 16.00, 16.75, 18.25, 19.00],
      [13.75, 16.75, 17.50, 19.00, 19.75],
      [14.50, 17.50, 18.25, 19.75, 20.50],
      [15.25, 18.25, 19.00, 20.50, 21.25],
      [16.00, 19.00, 19.75, 21.25, 22.00],
    ],
  },
  '약자 무시': {
    matrix: [
      [9.90, 12.30, 12.90, 14.10, 14.70],
      [10.73, 13.13, 13.73, 14.93, 15.53],
      [11.55, 13.95, 14.55, 15.75, 16.35],
      [12.38, 14.78, 15.38, 16.58, 17.18],
      [13.20, 15.60, 16.20, 17.40, 18.00],
    ],
  },
  '정밀 단도': {
    matrix: [
      [10.60, 12.70, 13.23, 14.28, 14.80],
      [11.13, 13.23, 13.76, 14.81, 15.33],
      [11.65, 13.75, 14.28, 15.33, 15.85],
      [12.18, 14.28, 14.81, 15.86, 16.38],
      [12.70, 14.80, 15.33, 16.38, 16.90],
    ],
  },
  '추진력': {
    matrix: [
      [9.80, 11.90, 12.43, 13.48, 14.00],
      [10.33, 12.43, 12.96, 14.01, 14.53],
      [10.85, 12.95, 13.48, 14.53, 15.05],
      [11.38, 13.48, 14.01, 15.06, 15.58],
      [11.90, 14.00, 14.53, 15.58, 16.10],
    ],
  },
  '마나의 흐름': {
    matrix: [
      [7.53, 7.53, 7.53, 7.53, 7.53],
      [8.40, 8.40, 8.40, 8.40, 8.40],
      [9.29, 9.29, 9.29, 9.29, 9.29],
      [10.20, 10.20, 10.20, 10.20, 10.20],
      [11.11, 11.11, 11.11, 11.11, 11.11],
    ],
  },
  '시선 집중': {
    matrix: [
      [7.50, 8.70, 9.00, 9.60, 9.90],
      [7.88, 9.08, 9.38, 9.98, 10.28],
      [8.25, 9.45, 9.75, 10.35, 10.65],
      [8.63, 9.83, 10.13, 10.73, 11.03],
      [9.00, 10.20, 10.50, 11.10, 11.40],
    ],
  },
  '부러진 뼈': {
    matrix: [
      [7.40, 8.20, 8.40, 8.80, 9.00],
      [7.65, 8.45, 8.65, 9.05, 9.25],
      [7.90, 8.70, 8.90, 9.30, 9.50],
      [8.15, 8.95, 9.15, 9.55, 9.75],
      [8.40, 9.20, 9.40, 9.80, 10.00],
    ],
  },
  '실드관통': {
    matrix: [
      [4.60, 5.40, 5.60, 6.00, 6.20],
      [4.80, 5.60, 5.80, 6.20, 6.40],
      [5.00, 5.80, 6.00, 6.40, 6.60],
      [5.20, 6.00, 6.20, 6.60, 6.80],
      [5.40, 6.20, 6.40, 6.80, 7.00],
    ],
  },
  '구슬동자': {
    matrix: [
      [4.00, 4.48, 4.60, 4.84, 4.96],
      [4.16, 4.64, 4.76, 5.00, 5.12],
      [4.32, 4.80, 4.92, 5.16, 5.28],
      [4.48, 4.96, 5.08, 5.32, 5.44],
      [4.64, 5.12, 5.24, 5.48, 5.60],
    ],
  },
  '승부사': {
    matrix: [
      [1.68, 1.98, 2.06, 2.21, 2.28],
      [1.68, 1.98, 2.06, 2.21, 2.28],
      [1.89, 2.19, 2.27, 2.42, 2.49],
      [1.89, 2.19, 2.27, 2.42, 2.49],
      [2.10, 2.40, 2.48, 2.63, 2.70],
    ],
  },
  '분쇄의 주먹': {
    matrix: [
      [1.30, 1.45, 1.49, 1.56, 1.60],
      [1.38, 1.53, 1.57, 1.64, 1.68],
      [1.45, 1.60, 1.64, 1.71, 1.75],
      [1.53, 1.68, 1.72, 1.79, 1.83],
      [1.60, 1.75, 1.79, 1.86, 1.90],
    ],
  },
};

// 유각장 → 인덱스 매핑
export const YUKAK_LEVELS = [0, 5, 10, 15, 20] as const;
// 어빌스톤 레벨 → 인덱스 매핑
export const ABIL_STONE_LEVELS = [0, 1, 2, 3, 4] as const;

/** 각인 계수 조회 */
export function getEngravingPercent(
  engravingName: string,
  yukakSheets: number,  // 0, 5, 10, 15, 20
  abilStoneLevel: number, // 0, 1, 2, 3, 4
): number | null {
  // 직접 이름 매치
  let data = ENGRAVING_DATA[engravingName];

  // aliases에서 검색
  if (!data) {
    for (const [, entry] of Object.entries(ENGRAVING_DATA)) {
      if (entry.aliases?.includes(engravingName)) {
        data = entry;
        break;
      }
    }
  }

  if (!data) return null;

  const yIdx = YUKAK_LEVELS.indexOf(yukakSheets as typeof YUKAK_LEVELS[number]);
  const aIdx = ABIL_STONE_LEVELS.indexOf(abilStoneLevel as typeof ABIL_STONE_LEVELS[number]);
  if (yIdx === -1 || aIdx === -1) return null;

  return data.matrix[yIdx][aIdx];
}

// ═══════════════════════════════════════
// 6. 보석 계수
// ═══════════════════════════════════════
// 보석 하나당 전투력 증가% (겁화/작열 구분 없음, 스킬 구분 없음)
// T4 보석은 기본 공격력%도 추가로 올려줌 (별도 계산)

export const GEM_POWER_PER_ONE: Record<number, Record<number, number>> = {
  // 3티어
  3: {
    1: 0.48, 2: 0.96, 3: 1.44, 4: 1.92, 5: 2.40,
    6: 2.88, 7: 3.36, 8: 3.84, 9: 4.80, 10: 6.40,
  },
  // 4티어 (기본 공격력% 제외한 순수 전투력 증가)
  4: {
    1: 1.28, 2: 1.92, 3: 2.56, 4: 3.20, 5: 3.84,
    6: 4.48, 7: 5.12, 8: 5.76, 9: 6.40, 10: 7.04,
  },
};

// 11개 기준 전투력 증가량 (97돌 없을 때)
export const GEM_11_TOTAL = {
  6: { purePower: 61.94, baseAtkPercent: 4.95, totalPower: 69.96 },
  7: { purePower: 73.20, baseAtkPercent: 6.60, totalPower: 84.62 },
  8: { purePower: 85.16, baseAtkPercent: 8.80, totalPower: 101.45 },
  9: { purePower: 97.86, baseAtkPercent: 11.00, totalPower: 119.62 },
  10: { purePower: 119.30, baseAtkPercent: 13.20, totalPower: 139.25 },
};

// ═══════════════════════════════════════
// 7. 장신구 연마 효과 (엘릭서/초월은 게임에서 삭제됨)
// ═══════════════════════════════════════
// 힘민지, 무기 공격력은 기본 공격력에서 계산
// 공격력+만 별도 (기본공격력 142,857 기준)

export const ACCESSORY_GRINDING = {
  common: {
    '공격력': {
      '하': { value: 80, percent: 0.0560 },
      '중': { value: 195, percent: 0.1365 },
      '상': { value: 390, percent: 0.2730 },
    },
  },
  ring: {
    '치명타 적중률': {
      '하': { value: '0.40%', percent: 0.309680 },
      '중': { value: '0.95%', percent: 0.735490 },
      '상': { value: '1.55%', percent: 1.200010 },
    },
    '치명타 피해량': {
      '하': { value: '1.10%', percent: 0.330000 },
      '중': { value: '2.40%', percent: 0.720000 },
      '상': { value: '4.00%', percent: 1.200000 },
    },
  },
  necklace: {
    // 기존 추가 피해 30% 가정
    '추가 피해': {
      '하': { value: '0.60%', percent: 0.46152 },
      '중': { value: '1.60%', percent: 1.23072 },
      '상': { value: '2.60%', percent: 1.99992 },
    },
    '적에게 주는 피해': {
      '하': { value: '0.55%', percent: 0.55 },
      '중': { value: '1.20%', percent: 1.20 },
      '상': { value: '2.00%', percent: 2.00 },
    },
  },
  earring: {
    // 공격력 %는 해당 수치 그대로 전투력 증가
    '공격력%': '수치 그대로 전투력 증가',
    // 무기 공격력 %는 기본 공격력에서 계산 (플레이어마다 다름)
    '무기 공격력%': '기본 공격력 항목에서 계산',
  },
};

// ═══════════════════════════════════════
// 10. 전투 스탯
// ═══════════════════════════════════════
// (치명 + 특화 + 신속) × 0.03 = 전투력 증가%
// 내실, 펫 효과, 팔찌 특성 모두 포함된 수치
// 엔드 스펙 기준 ~78% 증가
export const COMBAT_STAT_MULTIPLIER = 0.03; // 합산 × 0.03 = 전투력 증가%

// ═══════════════════════════════════════
// 11. 팔찌
// ═══════════════════════════════════════
// 전투 특성 → 전투 스탯 항목에서 계산
// 무기 공격력 → 기본 공격력에서 계산
// 도약 포인트 → 아크 패시브에서 계산
// 아래는 팔찌 고유 특수 옵션

export const BRACELET_EFFECTS: Record<string, { high: number; mid: number; low: number }> = {
  // 상옵/중옵/하옵 전투력 증가%
  '치적5%, 치명타 적주피 1.5%': { high: 4.5, mid: 4.0, low: 3.5 },
  '치피10%, 치명타 적주피 1.5%': { high: 4.5, mid: 4.0, low: 3.5 },
  '추피 3.5%, 대악마 피해량2.5%': { high: 4.5, mid: 4.0, low: 3.5 },
  '쿨증 2%, 적주피 5.5%': { high: 4.5, mid: 4.0, low: 3.5 },
  '적주피 3%, 무력화 적주피5%': { high: 4.0, mid: 3.4, low: 2.8 },
  '적주피 3%': { high: 3.0, mid: 2.5, low: 2.0 },
  '추피 4%': { high: 3.0768, mid: 2.69220, low: 2.3076 },
  '백어택 스킬 적주피 3.5%': { high: 2.45, mid: 2.10, low: 1.75 },
  '헤드어택 스킬 적주피 3.5%': { high: 2.45, mid: 2.10, low: 1.75 },
  '타대 스킬 적주피 3.5%': { high: 3.5, mid: 3.0, low: 2.5 },
  '치적 5%': { high: 3.5, mid: 2.94, low: 2.38 },
  '치피 10%': { high: 3.333, mid: 2.79972, low: 2.26644 },
};

// 무공(무기 공격력) 버프 옵션 (무기공격력 184,000 기준)
export const BRACELET_WEAPON_BUFF = {
  '적중시 무공 1480, 공이속1%, 6중첩': { high: 2.40, mid: 2.14, low: 1.88 },
  '무공 9000, 체력50% 이상일때 2400': { high: 0.65, mid: 0.59, low: 0.54 },
  '무공 8700, 30초마다 무공 150, 30중첩': { high: 1.21, mid: 1.13, low: 1.05 },
};

// ═══════════════════════════════════════
// 12. 카드 세트
// ═══════════════════════════════════════
export const CARD_SET_POWER = {
  '세구빛': { 30: 15.0, 24: 11.0, note: '하위 단계는 딜증량과 동일' },
  '암구빛': { 30: 15.0, 24: 11.0, note: '하위 단계는 딜증량과 동일' },
  '삼두정치': { full: 6.5 },
  '세 우마르가 오리라': { full: 8.4 },
  '플라티나의 주민들': { full: 8.4 },
  // 삼두 + 세우마르/플라티나 = 15.446% > 단일 세구빛 15%
};

// ═══════════════════════════════════════
// 13. 에스더
// ═══════════════════════════════════════
export const ESTHER_POWER: Record<string, number> = {
  '엘라 부여 0단계 6강': 0.50,
  '엘라 부여 0단계 8강': 0.95,
  '엘라 부여 1단계 6강': 0.75,
  '엘라 부여 1단계 8강': 1.43,
  '엘라 부여 2단계 6강': 1.00,
  '엘라 부여 2단계 8강': 1.90,
};

// ═══════════════════════════════════════
// 14. 아크 그리드
// ═══════════════════════════════════════
// ■ 구조:
//   - 6개 코어 슬롯 (질서/혼돈 × 해/달/별)
//   - 각 코어에 최대 4개 젬 장착 가능
//   - 코어: 등급(전설/유물/고대), Point, 의지력 공급, 코어 옵션(스킬 효과)
//   - 젬: 등급(전설/유물/고대), 타입(질서/혼돈), 포인트, 의지력 필요, 2개 효과
//
// ■ 젬 효과 종류 및 Level당 전투력 계수 (실측):
//   각 젬은 2개의 효과를 가지며, 효과별 Level이 있음.
//   전체 그리드의 Effects = 모든 젬의 동종 효과 Level 합산.
//   Level당 %값 = 그리드 총 %값 ÷ 그리드 총 Level
//
// ■ API에서 가져올 수 있는 것:
//   - /arkgrid → Slots[]: 코어별 Name, Grade, Point, Gems[]
//   - /arkgrid → Effects[]: 전체 합산 효과 Name, Level, Tooltip(%)
//   - 젬 Tooltip에서: 젬 타입, 포인트, 의지력, 개별 효과 Level + %

export const ARK_GRID_EFFECT_PER_LEVEL: Record<string, { perLevel: number; affectsCombatPower: boolean; source: string }> = {
  // 실측 데이터 (구아바밤바아 기준, 2개 캐릭터 교차 검증)
  '추가 피해': { perLevel: 0.08, affectsCombatPower: true, source: '개별 젬: Lv.2=0.16%, Lv.3=0.24%, Lv.4=0.32%, Lv.5=0.40% → 정확히 0.08%/Lv' },
  '낙인력': { perLevel: 0.166, affectsCombatPower: false, source: '전투력 미반영 확인 (19P↔18P 비교: 낙인력4→0 해도 CP 0.03% 차이). 파티 시너지 전용 스탯' },
  '아군 피해 강화': { perLevel: 0.052, affectsCombatPower: true, source: '개별 젬: Lv.1=0.05%, Lv.3=0.15% → 0.05%/Lv, 총합 Lv.33=1.73% → 0.052%/Lv' },
  '공격력': { perLevel: 0.037, affectsCombatPower: true, source: '총합 Lv.33=1.21% → 0.0367%/Lv. 개별 Lv.1=0.03% (저레벨 비선형 가능)' },
  '보스 피해': { perLevel: 0.083, affectsCombatPower: true, source: '개별 젬: Lv.2=0.16%, Lv.5=0.41% → 0.08~0.082%/Lv' },
  '아군 공격 강화': { perLevel: 0.13, affectsCombatPower: true, source: '처어단자아 총합 Lv.8=1.04% → 0.13%/Lv (추가 검증 필요)' },
};

// ■ 그리드 효과 → 전투력 반영 방식:
//   API Effects의 Tooltip %값이 직접 전투력 증가%로 반영 (곱연산)
//   예: 추가 피해 Lv.42 → +3.39% → 전투력 곱연산 요소 (1 + 0.0339)
//
// ■ 코어 등급별 차이:
//   전설: 의지력 공급 12pt, 코어 옵션 10P/14P까지
//   유물: 의지력 공급 15pt, 코어 옵션 10P/14P/17P/18P/19P까지
//   고대: 의지력 공급 ?, 코어 옵션 더 높은 레벨까지
//
// ■ 젬 등급별 차이:
//   전설: 젬 포인트 12~15, 의지력 효율 3~5
//   유물: 젬 포인트 18, 의지력 효율 5
//
// ■ 시뮬레이터 구현 방식:
//   1. API에서 현재 그리드 Effects(합산 %) 가져오기
//   2. 사용자가 젬 변경 시 → 해당 효과 Level 변화 계산
//   3. Level 변화 × perLevel = 변화% 계산
//   4. 전투력 변화율 = (1 + new%) / (1 + old%) - 1
//
// ■ 코어 옵션 전투력 기여 (실측 - 처어단자아):
//   코어 옵션은 P 임계점(10P, 14P, 17P, 18P, 19P, 20P) 달성 시 활성화
//   젬 효과와 별개로 코어 옵션 자체가 전투력에 곱연산으로 기여 (주요 요소!)
//   ★ 코어마다 옵션 값이 다름! 해/달/별 또는 코어 이름에 따라 분배가 다름
//
//   [질서의 달: 소용돌이]
//   ┌────────┬────────────┬──────────────────────────────────────────┐
//   │ 임계점  │ 전투력 기여  │ 검증 방법                                  │
//   ├────────┼────────────┼──────────────────────────────────────────┤
//   │ 10P    │ +0.911%    │ 0P→13P에서 젬효과 차감                     │
//   │ 14P    │ +2.663%    │ 13P→14P에서 젬변화 보정                    │
//   │ 17P+18P│ +3.204%    │ 14P→18P에서 젬변화 보정 (미분리)            │
//   │ 19P    │ +0.457%    │ 18P→19P에서 젬변화 보정                    │
//   │ 합계    │ +7.402%    │ (1.00911)(1.02663)(1.03204)(1.00457)     │
//   └────────┴────────────┴──────────────────────────────────────────┘
//
//   [질서의 해: 예측불가]
//   ┌────────┬────────────┬──────────────────────────────────────────┐
//   │ 임계점  │ 전투력 기여  │ 검증 방법                                  │
//   ├────────┼────────────┼──────────────────────────────────────────┤
//   │ 10P    │ +1.218%    │ 0P→10P에서 젬효과 차감                     │
//   │ 14P    │ +2.464%    │ 10P→14P에서 젬변화 보정                    │
//   │ 17~19P │ +3.492%    │ 14P→19P에서 젬변화 보정 (미분리)            │
//   │ 합계    │ +7.333%    │ (1.01218)(1.02464)(1.03492)              │
//   └────────┴────────────┴──────────────────────────────────────────┘
//
//   ※ 낙인력은 전투력에 반영되지 않음 (실측 확인)
//   ※ 코어별 합계는 비슷(~7.3-7.4%)하지만 임계점별 분배가 다름
//
//   ★ 핵심 발견: 같은 해/달/별 안에서 코어 이름을 바꿔도 전투력 변동 0!
//     → 코어 옵션 값은 코어 이름이 아니라 해/달/별 카테고리로 결정됨
//     → 시뮬레이터에서 해/달/별 (+ 등급?) 테이블만 있으면 구현 가능
//     → 캐릭터별/등급별 차이 여부 추가 검증 필요
//
// ■ 실측 데이터 (처어단자아, 질서의 달: 소용돌이):
//   | 상태       | 젬 효과                              | 전투력     |
//   |-----------|--------------------------------------|-----------|
//   | 0P(제거)   | -                                    | 2,529.68  |
//   | 13P(10P만) | 공격력6, 추피4, 아군피해강화9           | 2,578.63  |
//   | 14P       | 공격력6, 추피2, 아군피해강화6            | 2,638.99  |
//   | 18P       | 공격력6, 추피5, 아군피해강화11           | 2,737.01  |
//   | 19P       | 공격력8, 추피2, 낙인력4, 아군피해강화6   | 2,737.80  |
//
// ■ 실측 데이터 (처어단자아, 질서의 해: 예측불가):
//   | 상태       | 젬 효과                              | 전투력     | 세션 |
//   |-----------|--------------------------------------|-----------|------|
//   | 0P(제거)   | -                                    | 2,521.63  | 1차  |
//   | 10P       | 공격력4, 낙인력6, 아군피해강화5         | 2,562.77  | 1차  |
//   | 14P       | 공격력9, 추피4, 낙인력2, 아군피해강화3  | 2,636.37  | 1차  |
//   | 15P       | 공격력10, 추피4, 낙인력2, 아군피해강화5 | 2,637.16  | 2차  |
//   | 17P       | 공격력13, 낙인력4, 아군피해강화6        | 2,722.36  | 2차  |
//   | 19P       | 공격력14, 추피4, 낙인력2, 아군피해강화6 | 2,737.80* | 역산 |
//   (* 전체 전투력에서 역산)
//
//   ⚠️ 1차/2차 세션 간 base 변동 의심:
//   14P→15P는 같은 코어옵션(10P+14P)인데 CP 차이 +0.030%만 발생.
//   예상(공격력+1, 아군+2)은 +0.141%. 세션 간 소용돌이 젬 구성 변경으로
//   base가 ~0.11% 바뀐 것으로 추정. → 내일 0P 재측정 필요
//
// ■ 실측 데이터 (다른 캐릭터, 질서의 해: 피니셔, 유물 17P):
//   | 상태       | 젬 효과                              | 전투력     |
//   |-----------|--------------------------------------|-----------|
//   | 0P(제거)   | -                                    | 2,158.15  |
//   | 17P       | 공격력5, 추피13, 낙인력8              | 2,341.37  |
//   → 코어 옵션(10P+14P+17P) = +7.178%
//   → 예측불가 17P 코어옵션 = +7.107% (유사, 0.07% 차이는 계수 오차 범위)
//   → 같은 해 코어끼리 옵션값 동일 확인!
//
// ■ 핵심 발견 요약:
//   1. 같은 해/달/별 안에서 코어 이름 교체 → 전투력 변동 0 (확정)
//   2. 해 vs 달은 코어 옵션 분배가 다름 (확정)
//   3. 코어 옵션이 전투력의 ~7-8% 차지 (젬 효과 ~1%보다 훨씬 큼)
//   4. 곱연산 모델 정확 (소용돌이 5점 검증 0.04% 이내)
//   5. 낙인력 전투력 미반영 (확정)
//   6. 테스트된 코어는 전부 유물 등급
//
// ■ 내일 할 것 (우선순위순):
//   1. 예측불가 0P base 재측정 → 15P/17P 재계산
//   2. 별 코어 테스트 (해/달 완료, 별 미완)
//   3. 혼돈 코어 테스트 (질서만 완료)
//   4. 공격력 계수 정밀 측정 (현재 0.037%/Lv, 정밀화 필요)

// ═══════════════════════════════════════
// 15. 펫 방범대
// ═══════════════════════════════════════
// 추가 피해 기준 (기존 추가피해 30% 가정)
export const PET_PATROL = {
  '추가 피해 1%': { high: 0.77, mid: 0.54, low: 0.31 },
};

// ═══════════════════════════════════════
// 분석 노트 / 한계점
// ═══════════════════════════════════════
export const ANALYSIS_NOTES = [
  '반지 연마: 치명타 피해량이 실제 딜증 더 높지만, 전투력은 치적/치피 상옵 둘 다 1.20%로 동일하게 설정',
  '서폿 함께할 때 기본공격력 효율 ~20% 하락하지만 전투력에는 그대로 반영',
  '직업마다 각인 딜증이 달라서 최대 전투력이 직업별로 다름',
  '에포, 에포팔찌 등 스택형 옵션은 최대 중첩 기준',
  '합연산으로 효율 감소하는 부분도 곱연산 처리',
  '도약 포인트 전투력 심각하게 낮게 측정 (60→70 기준 1.79%)',
  '깨달음 메인 노드 찍을 수 있는지가 딜증에 큰 영향이지만 전투력은 미고려',
  'API에서 가져올 수 없는 데이터: 펫 방범대, 에스더 부여 상세, 카르마 상세',
];

// ═══════════════════════════════════════
// 실측 검증 결과 (구아바밤바아 vs 처어단자아)
// ═══════════════════════════════════════
export const VERIFICATION_RESULTS = {
  note: '2026-03-01 실측',
  discovery: {
    '전투력 vs 공격력': 'API profile에 CombatPower(전투력)와 공격력(Stats)이 별도 존재. 전투력 ≠ 공격력.',
    '기본공격력 직접 획득': '공격력 Tooltip에서 기본 공격력과 공격력 증감을 직접 파싱 가능',
    '아크패시브 Level→유각 매핑': 'ArkPassiveEffects의 Level × 5 = 유각장 수 (Lv.0→0장, Lv.1→5장, Lv.2→10장, Lv.3→15장)',
    '아크그리드 구조': '6코어 × 4젬, 젬마다 2효과, Effects에서 합산% 직접 제공',
    '아크그리드 젬 계수': '추피 0.08%/Lv, 아군피해강화 0.052%/Lv, 공격력 0.037%/Lv, 보스피해 0.083%/Lv, 아군공격강화 0.13%/Lv',
    '낙인력 전투력 미반영': '낙인력은 전투력에 반영되지 않음 (19P↔18P 비교: 낙인력4→0에도 CP 0.03% 차이). 파티 시너지 전용',
    '코어 옵션 전투력 기여': '코어 옵션(P 임계점 활성)이 전투력 주요 요소. 소용돌이 19P: 코어옵션 +7.40%, 젬 +0.77%',
    '코어 옵션 개별 분리(달:소용돌이)': '10P=+0.911%, 14P=+2.663%, 17P+18P=+3.204%, 19P=+0.457%',
    '코어 옵션 개별 분리(해:예측불가)': '10P=+1.218%, 14P=+2.464%, 17~19P=+3.492%',
    '해/달/별 카테고리가 기준': '같은 해 코어 안에서 이름을 바꿔도(예측불가↔다른이름) 전투력 변동 0. 코어 이름은 무관, 해/달/별이 코어 옵션 결정',
    '해 vs 달 옵션 차이 확인': '달 +7.40% vs 해 +7.33% (19P 기준). 해/달/별마다 옵션 분배가 다름',
    '코어 등급': '테스트한 코어는 전부 유물 등급. 등급별 차이는 미확인',
    '곱연산 모델 5점 검증(소용돌이)': '0P/13P/14P/18P/19P 모두 예측 오차 0.04% 이내로 곱연산 모델 확정',
  },
  issue: {
    '절대값 공식 불일치': '기본공격력 × 0.0288 × Π(1+요소%)로 계산하면 실제 CombatPower보다 ~35배 높음',
    '가능한 원인': [
      '모든 요소가 독립 곱연산이 아닐 수 있음 (카테고리 내 합산, 카테고리 간 곱연산)',
      '"순수기본공격력"이 API의 "기본 공격력"이 아닐 수 있음',
      '연구 원문의 "전투력"이 CombatPower 필드가 아니라 다른 지표일 수 있음',
    ],
    '비율 분석은 유효': '요소 변경 시 전투력 변화율 = (1+new%) / (1+old%) - 1 방식은 정확함',
    '예측불가 14P↔15P 불일치': [
      '14P(1차세션)→15P(2차세션) 전환 시 예상 +0.141% vs 실제 +0.030%',
      '원인: 세션 사이 소용돌이 젬 구성 변경으로 base가 ~0.11% 변동한 것으로 추정',
      '해결: 예측불가 0P base를 다시 측정하여 확인 필요',
    ],
  },
};

// ═══════════════════════════════════════
// 연구 과제 (TODO)
// ═══════════════════════════════════════
export const RESEARCH_TODO = [
  // ★★★ 최우선: 내일 바로 할 것 ★★★
  '⓵ 예측불가 0P base 재측정: 현재 base(2521.63)가 변동됐는지 확인 (예측불가 코어 빼고 전투력 확인)',
  '⓶ 새 base로 15P/17P 재계산 → 공격력/아군피해강화 계수 정밀도 검증',
  '⓷ 별 코어 테스트: 해/달 완료, 별 코어도 19P 장착/해제로 코어 옵션 합계 측정',
  '⓸ 혼돈 코어 테스트: 질서만 확인됨, 혼돈 코어도 같은 해/달/별 규칙인지 확인',
  // 우선순위 높음
  '아크그리드 17P/18P 개별 분리: 소용돌이 합산 +3.204%, 예측불가 합산 +3.492%',
  '아크그리드 20P 옵션 전투력 기여 측정',
  '아크그리드 코어 등급(전설/유물/고대) 차이 확인: 현재 유물만 테스트됨',
  '아크그리드 추가 젬 효과 타입 계수: 적에게 주는 피해, 치명타 적중률, 치명타 피해 등',
  '공격력 계수 정밀 측정: 현재 0.037%/Lv (총합 기반), 개별 변경 실험으로 정밀화 필요',
  // 우선순위 중간
  '장신구 연마 효과 상세 파싱 및 전투력 기여 검증',
  '팔찌 특수 효과(치피10%, 추피2.5% 등)의 정확한 전투력 반영 방식',
  'T4 보석 기본공격력% 보너스의 혼합 레벨 계산 방식 (11개 동레벨이 아닌 경우)',
  // 우선순위 낮음 (API에서 가져올 수 없음)
  '에스더 부여 효과 파싱 방법 조사',
  '펫 방범대 효과 파싱 방법 조사',
  '카르마 레벨/랭크 API 제공 여부 확인',
];

// ═══════════════════════════════════════
// API 매핑 참고
// ═══════════════════════════════════════
export const API_MAPPING_NOTES = `
■ API에서 가져올 수 있는 것:
  - /profiles: CombatPower(전투력), 공격력(기본공격력+증감 Tooltip), 전투 스탯(치특신), 전투 레벨, 아이템 레벨
  - /equipment: 무기 공격력/품질/추가피해, 방어구 힘, 장신구 연마, 팔찌, 어빌스톤
  - /engravings: ArkPassiveEffects(각인 Name/Level/AbilityStoneLevel)
  - /gems: 보석 이름(레벨+타입 파싱), 광휘=T4
  - /cards: Effects[].Items (세트명, 각성합계)
  - /arkpassive: Points(진화/깨달음/도약 Value)
  - /arkgrid: Slots[](코어 Name/Grade/Point, Gems[] 개별효과), Effects[](합산 Name/Level/Tooltip%)

■ 기본 공격력: API 공격력 Tooltip에서 직접 획득
  - "기본 공격력은 187,064 입니다" → 파싱 가능
  - "공격력 증감 효과로 14,314 증가" → 파싱 가능
  - sqrt(힘×무기공/6)으로 재계산도 가능하나, 총 힘은 장비 합산으로는 부족 (~15% 오차)

■ 각인 매트릭스 매핑:
  - ArkPassiveEffects.Level → 유각장 매핑: Level × 5 = 유각장 수
  - ArkPassiveEffects.AbilityStoneLevel → 어빌스톤 레벨 (0~4)
  - 매트릭스 조회: ENGRAVING_MATRIX[이름][Level][AbilityStoneLevel] = 전투력 %

■ API에서 가져올 수 없는 것:
  - 펫 방범대 효과, 에스더(엘라) 부여 상세, 카르마 레벨/랭크 상세

■ 삭제된 시스템: 엘릭서, 초월
`;
