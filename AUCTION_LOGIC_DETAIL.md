# 경매장 가격 수집 로직 상세 설명

## 📌 당신의 정리 검증

> "경매장은 정각 +10분에 한번씩 최저가를 가져와서 저장하고"

✅ **맞습니다!** 매시 10분마다 실행 (00:10, 01:10, 02:10, ...)

---

> "데이터가 쌓이는 만큼 계속 평균 계산해서 차트에 표시해주고"

✅ **맞습니다!** 실시간 평균 계산

### 예시 (11월 4일 예시)

| 시간 | 수집 가격 | todayTemp 누적 | 차트 표시 평균 |
|------|----------|---------------|--------------|
| 00:10 | 2,500,000 | [2500000] | **2,500,000** |
| 01:10 | 2,480,000 | [2500000, 2480000] | **2,490,000** |
| 02:10 | 2,520,000 | [2500000, 2480000, 2520000] | **2,500,000** |
| ... | ... | ... | ... |
| 05:10 | 2,490,000 | [2500000, 2480000, ..., 2490000] | **2,495,000** (6개 평균) |

**차트 조회 시 (getDailyPriceHistory):**
```javascript
// todayTemp에서 데이터 읽기
const prices = [2500000, 2480000, 2520000, ..., 2490000]; // 누적된 가격들
const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
// → 2,495,000 (평균) 계산해서 차트에 표시!
```

---

> "06시10분이 되면 전날에 수집했던 데이터를 최종 확정지어서 dailyprice에 저장하고"

✅ **맞습니다!**

### 06:10 동작 상세

#### 1단계: 전날 데이터 확정
```
11월 3일 todayTemp:
[2500000, 2480000, 2520000, ..., 2490000] (24개)

↓ 평균 계산

dailyPrices에 확정 저장:
{
  itemId: "auction_gem_fear_10",
  date: "2025-11-03",
  price: 2495000  ← 24개 평균
}
```

#### 2단계: 새 날 시작
```
11월 4일 06:10 현재 최저가: 2,468,000

todayTemp 새로 시작:
[2468000]  ← 11월 4일 첫 데이터
```

---

> "또 새로운 데이터를 todaytemp에 쌓으면서 평균 계산하고"

✅ **맞습니다!**

### 06:10 이후 계속 누적

| 시간 | 수집 가격 | todayTemp (11월 4일) | 차트 평균 |
|------|----------|---------------------|----------|
| 06:10 | 2,468,000 | [2468000] | **2,468,000** |
| 07:10 | 2,470,000 | [2468000, 2470000] | **2,469,000** |
| 08:10 | 2,465,000 | [2468000, 2470000, 2465000] | **2,467,667** |
| ... | ... | ... | ... |

---

## 🔄 완전한 사이클 (11월 3일 → 11월 4일)

```
11월 3일 00:10 ~ 05:10
└─ todayTemp에 계속 누적 [price1, price2, ..., price6]
└─ 차트에는 실시간 평균 표시

11월 4일 06:10 ⭐⭐⭐
├─ [확정] 11월 3일 todayTemp 평균 계산 → dailyPrices 저장
└─ [시작] 11월 4일 todayTemp 새로 시작 [price_new1]

11월 4일 07:10 ~ 11월 5일 05:10
└─ todayTemp에 계속 누적
└─ 차트에는 실시간 평균 표시

11월 5일 06:10 ⭐⭐⭐
├─ [확정] 11월 4일 todayTemp 평균 계산 → dailyPrices 저장
└─ [시작] 11월 5일 todayTemp 새로 시작
```

---

## 💡 핵심 포인트

1. **실시간 평균**: todayTemp에 데이터가 쌓일 때마다 차트는 평균을 보여줌
2. **확정은 06:10**: 전날 데이터를 평균내서 dailyPrices에 영구 저장
3. **연속성**: 06:10에 확정과 동시에 새 날 데이터도 수집 시작

---

## ✅ 완벽하게 이해하셨습니다! 👏

모든 설명이 100% 정확합니다.
