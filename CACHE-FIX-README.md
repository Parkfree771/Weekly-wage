# 가격 갱신 안될 때 해결 방법

Firebase에는 데이터가 있는데 사이트에 가격이 안 나오는 문제를 해결하는 방법입니다.

## 🚀 빠른 해결 (추천)

### 기본 (주요 아이템만 - 빠름, 30초)
```bash
quick-fix.bat
```
주요 7개 아이템만 빠르게 갱신

### 전체 갱신 (모든 거래소 아이템 - 2-3분)
```bash
quick-fix-all.bat
```
37개 전체 거래소 아이템 완전 갱신

**실행 시 자동으로:**
1. 모든 캐시 삭제
2. 최신 가격 갱신
3. 완료!

## 📝 개별 스크립트 사용

### 1. 가격 강제 갱신

#### 기본 (주요 아이템만 - 빠름)
```bash
node force-refresh-prices.js
```
파괴석, 수호석, 파편, 업화 등 주요 7개 아이템만 빠르게 체크

#### 전체 갱신 (모든 거래소 아이템)
```bash
node force-refresh-prices.js --all
```
재련 재료, 젬, 각인서 등 총 37개 거래소 아이템 전체 갱신

#### 카테고리별 갱신
```bash
node force-refresh-prices.js --refine      # 재련 재료만 (7개)
node force-refresh-prices.js --gem         # 젬만 (6개)
node force-refresh-prices.js --engraving   # 각인서만 (12개)
```

#### 특정 아이템만 갱신
```bash
node force-refresh-prices.js 66102106 66102006
```
특정 아이템 ID만 지정해서 갱신

### 2. 가격 확인만 (갱신 안 함)
```bash
node check-prices.js
```
주요 아이템의 현재 가격을 확인만 하고 갱신하지 않습니다.
문제 진단용으로 유용합니다.

### 3. 캐시 완전 삭제
```bash
node clear-all-cache.js
```

Next.js의 모든 캐시를 삭제합니다:
- `.next/cache` - Next.js 빌드 캐시
- `.next` - 전체 빌드 폴더
- `node_modules/.cache` - 패키지 캐시

## 🔧 문제별 해결 방법

### 문제 1: Firebase에 데이터 있는데 사이트에 안 보임
**원인**: Next.js 캐시 문제
**해결**:
```bash
node clear-all-cache.js
npm run build
npm run dev
```

### 문제 2: API 과부하로 가격 못 가져옴
**원인**: API Rate Limit 초과
**해결**:
```bash
# 5분 정도 기다린 후
node force-refresh-prices.js
```

### 문제 3: 특정 아이템만 가격 안 나옴
**원인**: 해당 아이템의 캐시 문제
**해결**:
```bash
# 해당 아이템만 갱신 (예: 수호석, 파괴석)
node force-refresh-prices.js 66102106 66102006
```

### 문제 4: 배포된 사이트(Netlify/Vercel)에서 문제 발생
**해결**:
1. Netlify/Vercel 대시보드 접속
2. "Deploys" 탭
3. "Trigger deploy" → "Clear cache and deploy" 선택
4. 재배포 완료까지 대기 (보통 1-2분)

## 💡 예방 방법

### 정기적인 캐시 관리
매일 또는 매주 한 번씩 실행:
```bash
quick-fix.bat
```

### API 호출 간격 조정
`app/api/market/batch-prices/route.ts` 파일에서:
```javascript
revalidate: 300,  // 5분 → 더 긴 시간으로 조정 (예: 600)
```

### 환경 변수 확인
`.env.local` 파일에 API 키가 제대로 설정되어 있는지 확인:
```
LOSTARK_API_KEY=your-api-key-here
```

## 🐛 여전히 안 될 때

1. **브라우저 캐시 삭제**: `Ctrl + Shift + R` (하드 새로고침)
2. **서버 재시작**:
   ```bash
   # 개발 서버 중지 (Ctrl+C)
   npm run dev
   ```
3. **Node.js 재시작**:
   ```bash
   # 모든 Node 프로세스 종료
   taskkill /f /im node.exe
   npm run dev
   ```

## 📊 전체 아이템 ID 목록

### 재련 재료 (7개)
- `6861012` - 아비도스 융화 재료
- `6861011` - 최상급 오레하 융화 재료
- `66130143` - 운명의 파편 주머니(대)
- `66130133` - 명예의 파편 주머니(대)
- `66102006` - 운명의 파괴석
- `66102106` - 운명의 수호석
- `66110225` - 운명의 돌파석

### 재련 추가 재료 (12개)
- `66112553` - 야금술 : 업화 [19-20] (무기)
- `66112551` - 야금술 : 업화 [15-18] (무기)
- `66112543` - 야금술 : 업화 [11-14] (무기)
- `66112554` - 재봉술 : 업화 [19-20] (방어구)
- `66112552` - 재봉술 : 업화 [15-18] (방어구)
- `66112546` - 재봉술 : 업화 [11-14] (방어구)
- `66112714` - 장인의 재봉술 : 2단계
- `66112712` - 장인의 재봉술 : 1단계
- `66112713` - 장인의 야금술 : 2단계
- `66112711` - 장인의 야금술 : 1단계
- `66111131` - 용암의 숨결
- `66111132` - 빙하의 숨결

### 젬 (6개)
- `67400003` - 질서의 젬 : 안정
- `67400103` - 질서의 젬 : 견고
- `67400203` - 질서의 젬 : 불변
- `67410303` - 혼돈의 젬 : 침식
- `67410403` - 혼돈의 젬 : 왜곡
- `67410503` - 혼돈의 젬 : 붕괴

### 유물 각인서 (12개)
- `65203905` - 아드레날린
- `65200505` - 원한
- `65203305` - 돌격대장
- `65201005` - 예리한 둔기
- `65203505` - 질량 증가
- `65202805` - 저주받은 인형
- `65203005` - 기습의 대가
- `65203705` - 타격의 대가
- `65203405` - 각성
- `65204105` - 전문의
- `65200605` - 슈퍼차지
- `65201505` - 결투의 대가

**총 거래소 아이템: 37개**
(경매장 아이템은 별도 수집 로직 필요)

## ⚠️ 주의사항

- API Rate Limit: 분당 100회 제한이 있으므로 너무 자주 실행하지 마세요
- 캐시 삭제 후에는 반드시 빌드/재시작이 필요합니다
- 배포 환경에서는 캐시 삭제 대신 "Clear cache and deploy"를 사용하세요
