# 가격 수집 로직 완벽 정리

## 🏪 거래소 (Market) - 매시 정각 (00분)

### API 응답 구조
```json
{
  "Stats": [
    { "Date": "2025-11-04", "AvgPrice": 1500 },  // [0] = 오늘
    { "Date": "2025-11-03", "AvgPrice": 1400 }   // [1] = 어제
  ]
}
```

### 시간대별 동작

#### 일반 시간 (01:00 ~ 05:00, 07:00 ~ 23:00)
```
Stats[0] (오늘 평균가) → todayTemp 덮어쓰기
```

#### 06:00 (평일/토일)
```
1. Stats[1] (어제 평균가) → dailyPrices 저장 (확정) ⭐
2. Stats[0] (오늘 평균가) → todayTemp 덮어쓰기
```

#### 수요일 06:00
```
Stats[0] (오늘 평균가) → todayTemp 덮어쓰기만
(어제 데이터는 저장 안함 - 업데이트 때문에)
```

#### 수요일 10:00
```
1. Stats[1] (업데이트 전날 평균가) → dailyPrices 저장 (확정) ⭐
2. Stats[0] (오늘 평균가) → todayTemp 덮어쓰기
```

---

## 🎯 경매장 (Auction) - 매시 10분

### API 응답 구조
```json
{
  "Items": [
    { "AuctionInfo": { "BuyPrice": 2500000 } }  // 현재 최저가만
  ]
}
```

### 시간대별 동작

#### 일반 시간 (00:10 ~ 05:10, 07:10 ~ 23:10)
```
Items[0].BuyPrice (현재 최저가) → todayTemp 누적 추가
```

#### 06:10 (매일)
```
1. 전날 todayTemp 데이터 평균 계산 → dailyPrices 저장 (확정) ⭐
2. Items[0].BuyPrice (현재 최저가) → todayTemp 누적 추가 (새로운 날)
```

---

## 📊 비교표

| 시간 | 거래소 (00분) | 경매장 (10분) |
|------|--------------|--------------|
| **00:00** | todayTemp 덮어쓰기 | - |
| **00:10** | - | todayTemp 누적 |
| **06:00** | ✅ dailyPrices 저장<br>todayTemp 덮어쓰기 | - |
| **06:10** | - | ✅ dailyPrices 저장 (평균)<br>todayTemp 누적 (새 날) |
| **07:00** | todayTemp 덮어쓰기 | - |
| **07:10** | - | todayTemp 누적 |
| **(수요일만) 10:00** | ✅ dailyPrices 저장<br>todayTemp 덮어쓰기 | - |

---

## 🔑 핵심 차이점

### 거래소
- **API가 이미 평균가 제공** (Stats[0], Stats[1])
- todayTemp는 **덮어쓰기** (최신값만 유지)
- 06:00에 **Stats[1]을 그대로 저장**

### 경매장
- **API는 현재가만 제공** (실시간 최저가)
- todayTemp는 **누적** (배열에 추가)
- 06:10에 **직접 평균 계산해서 저장**

---

## ✅ 당신의 정리 검증

> "거래소는 매시 정각에는 오늘 거래 평균가를 가져와서 db에 1시간에 한번씩 데이터를 덮어 씌우다가"

✅ 맞습니다! Stats[0]을 todayTemp에 덮어쓰기

> "06시가 지나면서 날이 지나면 06시에는 전날 평균 거래가와 현재 평균 거래가 2개의 가격을 가져와서"

✅ 맞습니다! Stats[1] (어제), Stats[0] (오늘) 둘 다 받음

> "전날 가격은 dailyprice에 저장하고 현재는 todaytemp에 저장하고"

✅ 맞습니다!
- Stats[1] → dailyPrices (확정 저장)
- Stats[0] → todayTemp (덮어쓰기)

> "07시에 또 가격 덮어쓰기하고"

✅ 맞습니다! Stats[0]을 todayTemp에 덮어쓰기

> "수요일만 그게 10시에 실행되고"

✅ 맞습니다! 수요일은 06:00에 전날 데이터 저장 안하고, 10:00에 저장

---

## 📌 완벽하게 이해하셨습니다! 👏
